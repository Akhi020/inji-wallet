default_platform(:android)

MIMOTO_HOST = ENV["MIMOTO_HOST"]
APPLICATION_THEME = ENV["APPLICATION_THEME"]
RELEASE_KEYSTORE_ALIAS = ENV["RELEASE_KEYSTORE_ALIAS"]
RELEASE_KEYSTORE_PASSWORD = ENV["RELEASE_KEYSTORE_PASSWORD"]
PLAY_CONSOLE_RELEASE_DESCRIPTION = ENV["PLAY_CONSOLE_RELEASE_DESCRIPTION"]

desc "Verify Build for Android"
lane :android_build do
  gradle(
    task: "assembleNewlogicDebug",
  )
end

desc "Deploy a alpha version to the Google Play"
lane :android_build_alpha do
  previous_build_number = google_play_track_version_codes(
    package_name: "io.mosip.residentapp",
    track: "internal",
    json_key: "play_config.json",
  )[0]
  
  current_build_number = previous_build_number + 1
  
  increment_version_code(
    gradle_file_path: "app/build.gradle",
    version_code: current_build_number
  )

  gradle(task: "clean bundleMosipRelease")
  upload_to_play_store(
  track: 'internal',
  release_status: 'completed',
  )
end